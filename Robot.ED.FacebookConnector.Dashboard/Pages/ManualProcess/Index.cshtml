@page
@model Robot.ED.FacebookConnector.Dashboard.Pages.ManualProcess.IndexModel
@{
    ViewData["Title"] = "Iniciar Processo Manual";
}

<div class="container mt-4">
    <div class="row">
        <div class="col-md-12">
            <h1 class="display-4"><i class="bi bi-play-circle"></i> @ViewData["Title"]</h1>
            <p class="text-muted">Use este formulário para iniciar manualmente um processo RPA</p>
        </div>
    </div>

    @if (Model.StatusMessage != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <h5 class="alert-heading"><i class="bi bi-check-circle-fill"></i> Sucesso!</h5>
            <p>@Model.StatusMessage</p>
            @if (Model.QueueId.HasValue)
            {
                <hr>
                <p class="mb-0">
                    <strong>Queue ID:</strong> @Model.QueueId<br>
                    <strong>Unique ID:</strong> @Model.UniqueId<br>
                    <small class="text-muted">Acompanhe o status na <a asp-page="/Index" class="alert-link">página principal</a></small>
                </p>
            }
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    @if (Model.ErrorMessage != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <h5 class="alert-heading"><i class="bi bi-exclamation-triangle-fill"></i> Erro!</h5>
            <p>@Model.ErrorMessage</p>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <div class="row">
        <div class="col-md-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="bi bi-file-earmark-text"></i> Detalhes do Processo</h5>
                </div>
                <div class="card-body">
                    <form method="post">
                        <div class="mb-3">
                            <label asp-for="ProcessRequest.TrackId" class="form-label">
                                <i class="bi bi-hash"></i> Track ID
                            </label>
                            <input asp-for="ProcessRequest.TrackId" class="form-control" readonly />
                            <small class="form-text text-muted">Identificador único do processo (gerado automaticamente)</small>
                        </div>

                        <div class="mb-3">
                            <label asp-for="ProcessRequest.AiConfig" class="form-label">
                                <i class="bi bi-gear"></i> Configuração AI <span class="text-danger">*</span>
                            </label>
                            <textarea asp-for="ProcessRequest.AiConfig" class="form-control" rows="3" placeholder="Cole a configuração AI em formato JSON..."></textarea>
                            <small class="form-text text-muted">Configuração do processamento de IA</small>
                        </div>

                        <div class="mb-3">
                            <label asp-for="ProcessRequest.Channel" class="form-label">
                                <i class="bi bi-broadcast"></i> Canal <span class="text-danger">*</span>
                            </label>
                            <input asp-for="ProcessRequest.Channel" class="form-control" placeholder="Ex: manual, facebook, instagram" />
                        </div>

                        <div class="mb-3">
                            <label asp-for="ProcessRequest.Customer" class="form-label">
                                <i class="bi bi-person"></i> Cliente <span class="text-danger">*</span>
                            </label>
                            <input asp-for="ProcessRequest.Customer" class="form-control" placeholder="Nome do cliente" />
                        </div>

                        <div class="mb-3">
                            <label asp-for="ProcessRequest.BridgeKey" class="form-label">
                                <i class="bi bi-key"></i> Bridge Key
                            </label>
                            <input asp-for="ProcessRequest.BridgeKey" class="form-control" placeholder="Chave de integração" />
                        </div>

                        <div class="mb-3">
                            <label asp-for="ProcessRequest.OriginType" class="form-label">
                                <i class="bi bi-diagram-3"></i> Tipo de Origem
                            </label>
                            <input asp-for="ProcessRequest.OriginType" class="form-control" placeholder="Ex: web, mobile, api" />
                        </div>

                        <div class="mb-3">
                            <label asp-for="ProcessRequest.MediaId" class="form-label">
                                <i class="bi bi-image"></i> Media ID
                            </label>
                            <input asp-for="ProcessRequest.MediaId" class="form-control" placeholder="ID da mídia associada" />
                        </div>

                        <div class="mb-3">
                            <label asp-for="ProcessRequest.Phrase" class="form-label">
                                <i class="bi bi-chat-quote"></i> Frase/Mensagem
                            </label>
                            <textarea asp-for="ProcessRequest.Phrase" class="form-control" rows="2" placeholder="Mensagem ou frase para processar"></textarea>
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg" id="startProcessBtn">
                                <i class="bi bi-play-fill"></i> Iniciar Processo
                            </button>
                            <a asp-page="/Index" class="btn btn-outline-secondary">
                                <i class="bi bi-arrow-left"></i> Voltar ao Dashboard
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="bi bi-info-circle"></i> Informações</h5>
                </div>
                <div class="card-body">
                    <h6><i class="bi bi-lightbulb"></i> Dicas:</h6>
                    <ul class="small">
                        <li>Os campos marcados com <span class="text-danger">*</span> são obrigatórios</li>
                        <li>O Track ID é gerado automaticamente</li>
                        <li>Após iniciar, você pode acompanhar o processo no dashboard principal</li>
                        <li>O processo será alocado para um robô disponível automaticamente</li>
                    </ul>

                    <hr>

                    <h6><i class="bi bi-clock-history"></i> Fluxo do Processo:</h6>
                    <ol class="small">
                        <li>Solicitação enviada à API</li>
                        <li>Processo adicionado à fila</li>
                        <li>Robô disponível alocado</li>
                        <li>Execução RPA iniciada</li>
                        <li>Resultado registrado</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.getElementById('startProcessBtn').addEventListener('click', function(e) {
            this.disabled = true;
            this.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Iniciando...';
            // Form will submit normally, button will be re-enabled on page reload
        });
    </script>
}
